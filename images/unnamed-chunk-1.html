<!doctype HTML>
<meta charset = 'utf-8'>
<html>
  <head>
    <link rel='stylesheet' href='http://timelyportfolio.github.io/rCharts_d3_sankey/css/sankey.css'>
    
    <script src='http://d3js.org/d3.v3.min.js' type='text/javascript'></script>
    <script src='http://timelyportfolio.github.io/rCharts_d3_sankey/js/sankey.js' type='text/javascript'></script>
    
    <style>
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 750px;
      height: 600px;
    }  
    </style>
    
  </head>
  <body>
    <div id='chart14c024130be' class='rChart rCharts_d3_sankey'></div>  
    
    ﻿<!--Attribution:
Mike Bostock https://github.com/d3/d3-plugins/tree/master/sankey
Mike Bostock http://bost.ocks.org/mike/sankey/
-->

<script>
(function(){
var params = {
 "dom": "chart14c024130be",
"width":    750,
"height":    600,
"data": {
 "source": [ "Acute Renal Failure", "Acute Renal Failure", "Acute Renal Failure", "Acute Renal Failure", "Acute Renal Failure", "Acute Renal Failure", "Acute Renal Failure", "Acute Renal Failure", "Acute Renal Failure", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Cardiac Arrest Requiring CPR", "Coma greater than 24 hours", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "DVT Requiring Therapy", "Deep Incisional SSI", "Deep Incisional SSI", "Deep Incisional SSI", "Deep Incisional SSI", "Deep Incisional SSI", "Deep Incisional SSI", "Deep Incisional SSI", "Deep Incisional SSI", "Deep Incisional SSI", "Deep Incisional SSI", "Deep Incisional SSI", "Graft/Prosthesis/Flap Failure", "Graft/Prosthesis/Flap Failure", "Graft/Prosthesis/Flap Failure", "Graft/Prosthesis/Flap Failure", "Graft/Prosthesis/Flap Failure", "Graft/Prosthesis/Flap Failure", "Graft/Prosthesis/Flap Failure", "Graft/Prosthesis/Flap Failure", "Graft/Prosthesis/Flap Failure", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "Myocardial Infarction", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "On Ventilator greater than 48 Hours", "Organ/Space SSI", "Organ/Space SSI", "Organ/Space SSI", "Organ/Space SSI", "Organ/Space SSI", "Organ/Space SSI", "Organ/Space SSI", "Organ/Space SSI", "Organ/Space SSI", "Peripheral Nerve Injury", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Pneumonia", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Progressive Renal Insufficiency", "Pulmonary Embolism", "Pulmonary Embolism", "Pulmonary Embolism", "Pulmonary Embolism", "Pulmonary Embolism", "Pulmonary Embolism", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Sepsis", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Septic Shock", "Stroke/CVA", "Stroke/CVA", "Stroke/CVA", "Stroke/CVA", "Stroke/CVA", "Stroke/CVA", "Stroke/CVA", "Stroke/CVA", "Stroke/CVA", "Stroke/CVA", "Stroke/CVA", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Superficial Incisional SSI", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Transfusions/Intraop/Postop", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Unplanned Intubation", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Urinary Tract Infection", "Wound Disruption", "Wound Disruption", "Wound Disruption", "Wound Disruption", "Wound Disruption", "Wound Disruption", "Wound Disruption", "Wound Disruption", "Wound Disruption", "Wound Disruption", "Wound Disruption" ],
"target": [ "Not Readmitted", "Readmitted:Infectious", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Neurological", "Readmitted:Genitourinary", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:Hem-onc", "Readmitted:Pain", "Readmitted:Unknown", "Not Readmitted", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Bleeding Complications", "Readmitted:Chronic disease progression", "Readmitted:Hem-onc", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Neurological", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:Unknown", "Not Readmitted", "Readmitted:Infectious", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Neurological", "Readmitted:Chronic disease progression", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Neurological", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:Hem-onc", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Neurological", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Chronic disease progression", "Readmitted:Hem-onc", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Unknown", "Not Readmitted", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:dehydration/ dyselectrolytemia", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Not Readmitted", "Readmitted:Infectious", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Cardiac", "Readmitted:Neurological", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Chronic disease progression", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:VTE", "Readmitted:Cardiac", "Readmitted:Bleeding Complications", "Readmitted:Hem-onc", "Readmitted:Unknown", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:Hem-onc", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Cardiac", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Cardiac", "Readmitted:Neurological", "Readmitted:Genitourinary", "Readmitted:Chronic disease progression", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:dehydration/ dyselectrolytemia", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Neurological", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:dehydration/ dyselectrolytemia", "Readmitted:Hem-onc", "Readmitted:Pain", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Neurological", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:Hem-onc", "Readmitted:Pain", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Pulmonary", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Cardiac", "Readmitted:Neurological", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:dehydration/ dyselectrolytemia", "Readmitted:Gastrointestinal", "Readmitted:Unknown", "Readmitted:Other", "Not Readmitted", "Readmitted:Infectious", "Readmitted:VTE", "Readmitted:Sepsis", "Readmitted:Graft/ prosthesis failure", "Readmitted:Genitourinary", "Readmitted:Bleeding Complications", "Readmitted:Wound complications", "Readmitted:Chronic disease progression", "Readmitted:Gastrointestinal", "Readmitted:Unknown" ],
"value": [ "260", "2", "1", "1", "3", "1", "7", "3", "8", "233", "3", "1", "1", "4", "3", "3", "1", "2", "1", "1", "11", "10", "141", "6", "27", "3", "2", "2", "2", "2", "1", "1", "3", "13", "1", "62", "115", "2", "1", "3", "5", "1", "1", "9", "3", "4", "45", "5", "21", "1", "1", "1", "1", "4", "1", "328", "8", "4", "6", "3", "1", "48", "5", "4", "1", "3", "2", "2", "4", "57", "2", "609", "5", "1", "7", "5", "4", "4", "5", "3", "3", "2", "3", "3", "23", "4", "36", "12", "2", "1", "4", "4", "1", "3", "2", "6", "351", "6", "2", "36", "8", "1", "7", "4", "1", "2", "3", "1", "1", "44", "115", "5", "1", "1", "6", "1", "9", "2", "1", "18", "1", "28", "20", "1", "1", "1", "6", "197", "39", "2", "5", "36", "6", "3", "4", "1", "1", "2", "1", "36", "1", "162", "2", "1", "2", "16", "2", "5", "1", "1", "2", "1", "13", "3", "205", "2", "2", "2", "2", "4", "41", "1", "2", "23", "1", "314", "218", "1", "2", "8", "10", "2", "1", "6", "12", "10", "2", "1", "15", "2", "3939", "124", "12", "18", "17", "37", "21", "10", "15", "38", "38", "27", "2", "6", "1", "17", "221", "21", "497", "6", "2", "11", "7", "2", "8", "11", "2", "4", "2", "3", "1", "1", "1", "36", "1", "281", "4", "2", "3", "16", "5", "6", "2", "31", "2", "2", "1", "1", "1", "53", "2", "106", "30", "3", "2", "3", "1", "5", "42", "1", "2", "6" ] 
},
"nodeWidth":     15,
"nodePadding":     10,
"layout":     32,
"id": "chart14c024130be" 
};

params.units ? units = " " + params.units : units = "";

//hard code these now but eventually make available
var formatNumber = d3.format("0,.0f"),    // zero decimal places
    format = function(d) { return formatNumber(d) + units; },
    color = d3.scale.category20();

if(params.labelFormat){
  formatNumber = d3.format(".2%");
}

var svg = d3.select('#' + params.id).append("svg")
    .attr("width", params.width)
    .attr("height", params.height);
    
var sankey = d3.sankey()
    .nodeWidth(params.nodeWidth)
    .nodePadding(params.nodePadding)
    .layout(params.layout)
    .size([params.width,params.height]);
    
var path = sankey.link();
    
var data = params.data,
    links = [],
    nodes = [];
    
//get all source and target into nodes
//will reduce to unique in the next step
//also get links in object form
data.source.forEach(function (d, i) {
    nodes.push({ "name": data.source[i] });
    nodes.push({ "name": data.target[i] });
    links.push({ "source": data.source[i], "target": data.target[i], "value": +data.value[i] });
}); 

//now get nodes based on links data
//thanks Mike Bostock https://groups.google.com/d/msg/d3-js/pl297cFtIQk/Eso4q_eBu1IJ
//this handy little function returns only the distinct / unique nodes
nodes = d3.keys(d3.nest()
                .key(function (d) { return d.name; })
                .map(nodes));

//it appears d3 with force layout wants a numeric source and target
//so loop through each link replacing the text with its index from node
links.forEach(function (d, i) {
    links[i].source = nodes.indexOf(links[i].source);
    links[i].target = nodes.indexOf(links[i].target);
});

//now loop through each nodes to make nodes an array of objects rather than an array of strings
nodes.forEach(function (d, i) {
    nodes[i] = { "name": d };
});

sankey
  .nodes(nodes)
  .links(links)
  .layout(params.layout);
  
var link = svg.append("g").selectAll(".link")
  .data(links)
.enter().append("path")
  .attr("class", "link")
  .attr("d", path)
  .style("stroke-width", function (d) { return Math.max(1, d.dy); })
  .sort(function (a, b) { return b.dy - a.dy; });

link.append("title")
  .text(function (d) { return d.source.name + " → " + d.target.name + "\n" + format(d.value); });

var node = svg.append("g").selectAll(".node")
  .data(nodes)
.enter().append("g")
  .attr("class", "node")
  .attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")"; })
.call(d3.behavior.drag()
  .origin(function (d) { return d; })
  .on("dragstart", function () { this.parentNode.appendChild(this); })
  .on("drag", dragmove));

node.append("rect")
  .attr("height", function (d) { return d.dy; })
  .attr("width", sankey.nodeWidth())
  .style("fill", function (d) { return d.color = color(d.name.replace(/ .*/, "")); })
  .style("stroke", function (d) { return d3.rgb(d.color).darker(2); })
.append("title")
  .text(function (d) { return d.name + "\n" + format(d.value); });

node.append("text")
  .attr("x", -6)
  .attr("y", function (d) { return d.dy / 2; })
  .attr("dy", ".35em")
  .attr("text-anchor", "end")
  .attr("transform", null)
  .text(function (d) { return d.name; })
.filter(function (d) { return d.x < params.width / 2; })
  .attr("x", 6 + sankey.nodeWidth())
  .attr("text-anchor", "start");

// the function for moving the nodes
  function dragmove(d) {
    d3.select(this).attr("transform", 
        "translate(" + (
                   d.x = Math.max(0, Math.min(params.width - d.dx, d3.event.x))
                ) + "," + (
                   d.y = Math.max(0, Math.min(params.height - d.dy, d3.event.y))
                ) + ")");
        sankey.relayout();
        link.attr("d", path);
  }
})();
</script>
    
  </body>
</html>
